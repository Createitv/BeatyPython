# 工厂模式

工厂模式三姐妹：**简单工厂**模式（小妹妹）、**工厂方法**模式（妹妹）、**抽象工厂**模式（姐姐）。这三种模式可以理解为同一种编程思想的三个版本，从简单到高级不断升级。故事剧情的模拟代码（源码示例15-1）用的就是最简单的一个版本—简单工厂模式。工厂方法模式是简单工厂模式的升级，抽象工厂模式又是工厂方法模式的升级！

## 简单工厂

这是最简单的一个版本，只有一个工厂类 SimpleFactory，类中有一个静态的创建方法createProduct，该方法根据参数传递过来的类型值（type）或名称（name）来创建具体的产品（子类）对象。

![简单工厂](https://typora-1300715298.cos.ap-shanghai.myqcloud.com/uPic/image-20210615153223732.png)

### 优缺点

#### 优点：

（1）实现简单、结构清晰。
（2）抽象出一个专门的类来负责某类对象的创建，分割出创建的职责，不能直接创建具体的对象，只需传入适当的参数即可。
（3）使用者可以不关注具体对象的类名称，只需知道传入什么参数可以创建哪些需要的对象。

#### 缺点：

（1）不易拓展，一旦添加新的产品类型，就不得不修改工厂的创建逻辑。不符合“开放封闭”原则，如果要增加或删除一个产品类型，就要修改switch...case...（或if...else...）的判断代码。
（2）当产品类型较多时，工厂的创建逻辑可能过于复杂，switch...case...（或if...else...）判断会变得非常多。一旦出错可能造成所有产品创建失败，不利于系统的维护。

### 应用场景

（1）产品具有明显的继承关系，且产品的类型不太多。
（2）所有的产品具有相同的方法和类似的属性，使用者不关心具体的类型，只希望传入合适的参数能返回合适的对象。

## 工厂方法模式

工厂方法模式是简单工厂模式的一个升级版本，为解决简单工厂模式不符合“开放-封闭”原则的问题。定义一个创建对象（实例化对象）的接口，让子类来决定创建哪个类的实例。工厂方法使一个类的实例化延迟到其子类。

![工厂方法模式](https://typora-1300715298.cos.ap-shanghai.myqcloud.com/uPic/image-20210615153523503.png)

### 优缺点

#### 优点：

（1）解决了简单工厂模式不符合“开放-封闭”原则的问题，使程序更容易拓展。
（2）实现简单。

#### 缺点：

对于有多种分类的产品，或具有二级分类的产品，工厂方法模式并不适用。
多种分类：如我们有一个电子白板程序，可以绘制各种图形，那么画笔的绘制功能可以理解为一个工厂，而图形可以理解为一种产品；图形可以根据形状分为直线、矩形、椭圆等，也可以根据颜色分为红色图形、绿色图形、蓝色图形等。
二级分类：如一个家电工厂，它可能同时生产冰箱、空调和洗衣机，那么冰箱、空调、洗衣机属于一级分类；而洗衣机又可分为高效型的和节能型的，高效型洗衣机和节能型洗衣机就属于二级分类。

#### 应用场景

（1）客户端不知道它所需要的对象的类。
（2）工厂类希望通过其子类来决定创建哪个具体类的对象。
因为工厂方法模式简单且易拓展，因此在项目中应用得非常广泛，在很多标准库和开源项目中都能看到它的影子。

## 抽象工厂模式

抽象工厂模式是工厂方法模式的升级版本，工厂方法模式不能解决具有二级分类的产品的创建问题，抽象工厂模式就是用来解决这一问题的。

![抽象工厂模式](https://typora-1300715298.cos.ap-shanghai.myqcloud.com/uPic/image-20210615153820209.png)

### 优缺点

#### 优点：

解决了具有二级分类的产品的创建。

#### 缺点：

（1）如果产品的分类超过二级，如三级甚至更多级，抽象工厂模式将会变得非常臃肿。
（2）不能解决产品有多种分类、多种组合的问题。

### 应用场景

（1）系统中有多于一个的产品族，而每次只使用其中某一产品族。
（2）产品等级结构稳定，设计完成之后，不会向系统中增加新的产品等级结构或者删除已有的产品等级结构。

### 进一步思考

如果产品出现三级甚至更多级分类怎么办？如果程序中出现了三级分类的对象，就需要重新审视一下你的设计，看一下有些类是不是可以进行归纳、抽象合并。如果实际的应用场景中确实有三级甚至更多级分类，建议你不要使用工厂模式了，直接交给每一个具体的产品类自己去创建吧！因为超过三级（含三级）以上分类，会使工厂类变得非常臃肿而难以维护，开发成本也会急剧增加。模式是死的，人是活的，不要为了使用设计模式而使用设计模式！
如果产品有多种分类、多种组合怎么办？ 如果产品有多种分类，就不能单独使用工厂模式了，需要结合其他的设计模式进行优化。如白板程序，既有形状的分类又有颜色的分类，可以结合桥接模式一起使用，用桥接模式来定义产品，再用工厂模式来创建产品。

